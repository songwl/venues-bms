<#import "/base/bms.html" as bms>
<#import "/base/func.html" as func>
<#import "/base/dict.html" as dict>
<#import "/venue/attr.html" as attr>

	<div class="wrapper">
		<div class="row">
			<div class="col-md-12">
                <!--breadcrumbs start -->
                <ul class="breadcrumb panel">
                    <li><a href="#"><i class="fa fa-home"></i> 酒店及会议室信息发布平台</a></li>
                    <li><a href="#">场所管理</a></li>
                    <li class="active"><#if action=="create">新增<#else>编辑</#if></li>
                </ul>
                <!--breadcrumbs end -->
            </div>
		</div>
		<div class="row">
			<div class="col-md-12">
				<section class="panel">
					<@func.validForm "${ctx}/venue/${action}" "${ctx}/venue/list">
						<input type="hidden" name="userId" value="${sysUser.userId}" />
						<@func.formGroup "场所编号" "venueCode">
							<input type="text" class="form-control {required:true}" name="venueCode"  value="${venue.venueCode}" <#if venue.venueCode??>readonly</#if> />
						</@func.formGroup>
						<@func.formGroup "场所管理员" "venueManager">
							<input type="text" class="form-control {required:true}" name="venueManager"  value="${venue.venueManager}" />
						</@func.formGroup>
						<@func.formGroup "场所类型" "venueTypes">
			               <@dict.showCheckbox dictKey="enums.VENUE_TYPE" selectValue="${venue.venueTypes}" objectName="venueTypes" required="required" />
						</@func.formGroup>
						<@func.formGroup "语言" "languages">
			               <@dict.showCheckbox dictKey="enums.LANGUAGE" selectValue="${venue.languages}" objectName="languages" required="required" />
						</@func.formGroup>
						<@func.formGroup "地区" "area">
			               <select name="stateId" class="form-control m-bot15">
				           </select>
				           <select name="provinceId" class="form-control m-bot15">
				           </select>
				           <select name="cityId" class="form-control m-bot15">
				           </select>
						</@func.formGroup>
						<@func.formGroup "经度" "longitude">
			               <input type="text" class="form-control {required:true}" name="longitude"  value="${venue.longitude}" />
						</@func.formGroup>
						<@func.formGroup "纬度" "latitude">
			               <input type="text" class="form-control {required:true}" name="latitude"  value="${venue.latitude}" />
						</@func.formGroup>
						<@func.formGroup "排序" "seq">
			               <input type="text" class="form-control {required:true}" name="seq"  value="${venue.seq}" />
						</@func.formGroup>
						<@func.formGroup "支付类型" "payType">
			               <input type="text" class="form-control {required:true}" name="payType"  value="${venue.payType}" />
						</@func.formGroup>
						
						<@showDictContent dictType="EMNU" dictKey="enums.LANGUAGE" />
						<#assign languages = dictList />
						<#list attrGroups as attrGroup>
							<#list languages as language>
								<div id="${attrGroup.venueType}_${language.value}" class="attrGroup">
									${attrGroup.attrGroupName}(${language.label})
									<#list attrGroup.attrs as attr>
										<#assign key = "${attrGroup.venueType}_${language.value}_${attr.attrCode}" />	
										<#assign prefix = "attrs[${key}]" />
										<input type="hidden" name="${prefix}.language" value="${language.value}" />
										<input type="hidden" name="${prefix}.venueType" value="${attrGroup.venueType}" />
										<input type="hidden" name="${prefix}.attrId" value="${attr.attrId}" />
										<input type="hidden" name="${prefix}.attrCode" value="${attr.attrCode}" />
										<@attr.showAttr attr "${prefix}.attrValue" "${venue.attrs[key].attrValue}" />
									</#list>
								</div>
							</#list>
						</#list>
						
						<div class="form-group">
                            <div class="col-lg-offset-2 col-lg-10">
                                <button type="submit" class="btn btn-primary">保  存</button>
                                <a target href="${ctx}/venue/list" class="btn btn-default">返  回</a>
                            </div>
                        </div>
					</@func.validForm>
				</section>
			</div>
		</div>
		
	</div>
	
	<script type="text/javascript">
		$(".attrGroup").hide();
		$(".attrGroup").find("input,textarea").prop("disabled",true);
		
		$(function(){
			//初始化选中的数据
			$("input[name='venueTypes']:checked").each(function(i,ele){
				var venueType = $(ele).prop("value");
				$("input[name='languages']:checked").each(function(i,iele){
					var language = $(iele).prop("value");
					var divId = "#"+venueType+"_"+language;
					
					$(divId).find("input,textarea").prop("disabled",false);
					$(divId).show();
				});
			});
			
			//点击事件 
			$("input[name='venueTypes']").each(function(i,ele){
				$(ele).click(function(){
					var checked = $(ele).prop("checked");
					var venueType = $(ele).prop("value");
					$("input[name='languages']:checked").each(function(i,iele){
						var language = $(iele).prop("value");
						var divId = "#"+venueType+"_"+language;
						if(checked){
							$(divId).find("input,textarea").prop("disabled",false);
							$(divId).show();
						}else{
							$(divId).find("input,textarea").prop("disabled",true);
							$(divId).hide();
						}
					});
					
				});
			});		
			
			$("input[name='languages']").each(function(i,ele){
				$(ele).click(function(){
					var checked = $(ele).prop("checked");
					var language = $(ele).prop("value");
					$("input[name='venueTypes']:checked").each(function(i,iele){
						var venueType = $(iele).prop("value");
						var divId = "#"+venueType+"_"+language;
						if(checked){
							$(divId).find("input,textarea").prop("disabled",false);
							$(divId).show();
						}else{
							$(divId).find("input,textarea").prop("disabled",true);
							$(divId).hide();
						}
					});
					
				});
			});	
		});
	</script>